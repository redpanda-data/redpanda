language: none

branches:
  only:
    - master
    - release/*

git:
   submodules: true

env:
  global:
    - CI: "true"
    - LC_ALL: "en_US.UTF-8"
    - LANG: "en_US.UTF-8"


build:
  pre_ci:
  - docker build -t redpanda_ci tools/ci
  pre_ci_boot:
    image_name: redpanda_ci
    image_tag: latest
    pull: false
  ci:
    - |
      . /etc/os-release
      if [[ "${ID}" != "fedora" ]]; then  exit 1; fi
      echo "Using CI image"
    - |
      bash -c 'python3 tools/build.py --deps=true --targets=all \
              --build=release --log=debug --fmt=false \
              --clang=internal --packages rpm deb tar'
    - |
      bash -c 'python3 tools/build.py --targets=all --build=debug \
               --log=info --fmt=false --clang=internal'

  advancedReporting: true

integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - v-dev@vectorized.io
      on_cancel: never
      sendFailingSnippet: true
